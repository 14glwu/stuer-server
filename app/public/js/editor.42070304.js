(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["editor"],{"0dab":function(t,e,i){"use strict";i.r(e);var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"editor-container block"},[i("div",{staticClass:"editor-header"},[i("div",{staticClass:"header-left"},[i("div",{staticClass:"header-name"},[t._v(t._s(t.header_name))]),i("a",{staticClass:"header-daft",attrs:{href:"javascript:void(0)"}},[t._v(t._s(t.header_draft))])]),i("div",[i("el-button",{attrs:{size:"small"}},[t._v("取消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.setPost}},[t._v("确定")])],1)]),i("div",{staticClass:"post-title"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.form.title,expression:"form.title"}],staticClass:"title-input",attrs:{type:"text",placeholder:"帖子标题：一句话说明你遇到的问题或想分享的经验"},domProps:{value:t.form.title},on:{input:[function(e){e.target.composing||t.$set(t.form,"title",e.target.value)},t.titleChange]}})]),i("div",{staticClass:"editor"},[i("div",{ref:"editor_bar",staticClass:"editor-bar"}),i("div",{ref:"editor_main",staticClass:"editor-main"})]),i("el-dialog",{staticClass:"dialog",attrs:{title:"帖子设置",visible:t.dialogVisible,top:"25vh"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{model:t.form}},[i("el-form-item",{attrs:{label:"发表区域","label-width":t.formLabelWidth}},[i("el-select",{attrs:{placeholder:"请选择发表区域"},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",t._n(e))},expression:"form.type"}},[i("el-option",{attrs:{label:"讨论区",value:1}}),i("el-option",{attrs:{label:"找对象",value:3}})],1)],1),1===t.form.type?i("el-form-item",{attrs:{label:"帖子标签","label-width":t.formLabelWidth}},[t._l(t.form.tags,function(e){return i("el-tag",{key:e,attrs:{closable:"","disable-transitions":!1},on:{close:function(i){return t.handleClose(e)}}},[t._v(t._s(e))])}),t.inputVisible?i("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):i("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 新标签")])],2):t._e()],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:t.submitPost}},[t._v("确 定")])],1)],1)],1)},n=[],s=(i("96cf"),i("3b8d")),a=i("cebc"),o=i("2f62"),l=i("365c"),u={data:function(){return{header_name:"写帖子",header_draft:"",editor:null,isEdit:!1,form:{title:"",content:"",type:1,tags:[]},titleTimer:null,contentTimer:null,dialogVisible:!1,formLabelWidth:"120px",inputVisible:!1,inputValue:""}},computed:Object(a["a"])({},Object(o["b"])(["user"])),mounted:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.initEditor(),t.next=3,this.initContent();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),beforeDestroy:function(){this.contentTimer&&(clearTimeout(this.contentTimer),self.contentTimer=null),this.titleTimer&&(clearTimeout(this.titleTimer),self.titleTimer=null)},methods:{submitPost:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,i,r;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.dialogVisible=!1,e=this.editor.txt.text(),e){t.next=5;break}return this.$message.error("内容不能为空"),t.abrupt("return");case 5:if(2===this.form.type||this.form.title){t.next=8;break}return this.$message.error("标题不能为空"),t.abrupt("return");case 8:if(this.form.content=this.editor.txt.html(),this.isEdit){t.next=16;break}return t.next=12,Object(l["a"])(this.form);case 12:i=t.sent,0===i.code?this.$message.success("帖子发表成功"):this.$message.error("帖子发表失败"),t.next=20;break;case 16:return t.next=18,Object(l["m"])(this.form);case 18:r=t.sent,0===r.code?this.$message.success("帖子更新成功"):this.$message.error("帖子更新失败");case 20:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),setPost:function(){this.dialogVisible=!0},handleClose:function(t){this.form.tags.splice(this.form.tags.indexOf(t),1)},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick(function(e){t.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var t=this.inputValue;t&&this.form.tags.push(t),this.inputVisible=!1,this.inputValue=""},titleChange:function(){var t=this;t.header_draft="草稿保存中...",t.titleTimer&&(clearTimeout(t.titleTimer),t.titleTimer=null);var e=t.form.title;t.titleTimer=setTimeout(function(){localStorage.setItem("draftTitle",e),t.header_draft="草稿已保存"},1500)},initEditor:function(){var t=window.wangEditor;this.editor=new t(this.$refs.editor_bar,this.$refs.editor_main),this.editor.customConfig.zIndex=100,this.editor.customConfig.uploadImgServer="/api/uploadImgsForPost",this.editor.customConfig.uploadImgMaxSize=3145728,this.editor.customConfig.uploadImgMaxLength=5,this.editor.customConfig.onchangeTimeout=1e3;var e=this;this.editor.customConfig.customAlert=function(t){e.$message.error(t)},this.editor.customConfig.onchange=function(t){e.contentTimer&&(clearTimeout(e.contentTimer),e.contentTimer=null),e.header_draft="草稿保存中...",localStorage.setItem("draft",t),e.contentTimer=setTimeout(function(){e.header_draft="草稿已保存"},2e3)},this.editor.create()},initContent:function(){var t=Object(s["a"])(regeneratorRuntime.mark(function t(){var e,i,r,n,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=localStorage.getItem("draft"),i=localStorage.getItem("draftTitle"),e&&this.editor.txt.html(e),i&&(this.form.title=i),r=this.editor.txt.text(),r||this.editor.txt.html("<p>来写点东西，抒发你心中所想吧！！！</p>"),!this.$route.query.id){t.next=12;break}return this.isEdit=!0,t.next=10,Object(l["e"])(this.$route.query.id);case 10:n=t.sent,0===n.code&&(s=n.data,s.userId!==this.user.id||2===s.type?window.location.href="/":(this.form=s,s.content&&this.editor.txt.html(s.content)));case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},c=u,d=(i("f48d"),i("2877")),m=Object(d["a"])(c,r,n,!1,null,"255f2d78",null);e["default"]=m.exports},"951c":function(t,e,i){},f48d:function(t,e,i){"use strict";var r=i("951c"),n=i.n(r);n.a}}]);
//# sourceMappingURL=editor.42070304.js.map